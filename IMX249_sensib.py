# wavelength (nm), quantum efficiency (%)

import colour
import numpy as np
import matplotlib.pyplot as plt

B = [
    [304.6152849821373, 1.7725155465985694],
    [316.13823853741667, 1.750183593693123],
    [327.66119209269607, 1.8283454288622067],
    [339.1841456479754, 1.8730093346731138],
    [350.70709920325476, 1.9846690992003744],
    [362.23005275853416, 1.9958350756531047],
    [373.75300631381344, 1.8953412875785602],
    [382.9189920964221, 3.5158036202804084],
    [386.74251759431024, 6.392996602736545],
    [388.9423541821363, 9.402227256746173],
    [391.1421907699623, 12.165806428795818],
    [393.50664098000664, 15.822504203114221],
    [395.7513721920741, 19.9885528053333],
    [398.0210448620534, 23.67457835862038],
    [399.41776650511747, 26.89875405934498],
    [401.5128489697138, 30.177518978282905],
    [404.13170205045907, 33.64393433482914],
    [407.27432574735343, 36.87834551396873],
    [410.4169494442478, 39.70333755650838],
    [413.5595731411422, 42.794452037838],
    [416.28318034511733, 45.32875649339168],
    [420.36859115107995, 48.178313684127325],
    [425.0825266964215, 51.42091324599891],
    [430.3202328579122, 54.27047043673456],
    [435.0341684032537, 57.26741851664619],
    [440.79564518089336, 60.180143231314396],
    [447.08089257468214, 63.13848893548945],
    [455.4612224330671, 65.61956890328514],
    [467.88206847317343, 66.40740829899961],
    [476.71134457397187, 64.95280059510809],
    [484.7923769374146, 61.64001489553364],
    [491.0776243312033, 58.679914537916005],
    [492.1251655635014, 55.94090051406235],
    [495.26778926039583, 53.316523848456676],
    [498.4104129572902, 50.76447789698366],
    [501.55303665418455, 48.07595889997734],
    [504.2766438581597, 45.009409566843715],
    [507.6886353005021, 41.212339517119624],
    [510.98090774486764, 37.635770916678645],
    [513.7045149488429, 34.397265546173045],
    [516.6376303992774, 30.93357965053748],
    [519.3612376032527, 27.564060156319897],
    [522.503861300147, 24.472945674990285],
    [525.6464849970414, 21.534875966151617],
    [529.3128793100848, 18.224186102633567],
    [535.0743560877245, 15.53123173164741],
    [541.3596034815132, 12.576395334357485],
    [549.2161627237492, 9.77991641025963],
    [557.5964925821341, 6.939571150097478],
    [567.5481342889664, 4.329524154272804],
    [579.0710878442457, 2.810951356702091],
    [590.594041399525, 2.140992769538528],
    [602.1169949548043, 1.5826939469022392],
    [613.6399485100837, 1.2142167239622808],
    [625.1629020653631, 1.1360548887932111],
    [636.2668391277232, 1.5168146858311644],
    [648.2088091759218, 2.2079886282548955],
    [659.7317627312011, 3.067768815114789],
    [671.2547162864805, 3.5814037319401706],
    [682.7776698417599, 3.101266744472966],
    [694.3006233970393, 2.0851628872749046],
    [705.8235769523187, 1.1918847710568343],
    [717.3465305075979, 0.4214323958187407],
    [728.8694840628773, 0.2762747019333176],
    [740.3924376181567, 0.2762747019333176],
    [751.9153911734361, 0.2762747019333176],
    [763.4383447287155, 0.23161079612241053],
    [774.9612982839947, 0.2762747019333176],
    [786.4842518392741, 0.2762747019333176],
    [798.0072053945535, 0.5889220426096387],
    [809.5301589498329, 0.2762747019333176],
    [821.0531125051123, 0.15344896095332672],
    [832.5760660603917, 0.15344896095332672],
    [844.0990196156708, 0.15344896095332672],
    [855.6219731709502, 0.15344896095332672],
    [867.1449267262296, 0.15344896095332672],
    [878.667880281509, 0.15344896095332672],
    [890.1908338367884, 0.15344896095332672],
    [901.7137873920676, 0.15344896095332672],
    [913.236740947347, 0.15344896095332672],
    [924.7596945026264, 0.15344896095332672],
    [936.2826480579058, 0.15344896095332672],
    [947.8056016131852, 0.15344896095332672],
    [959.3285551684644, 0.15344896095332672],
    [970.8515087237438, 0.15344896095332672],
    [982.3744622790232, 0.15344896095332672],
    [993.8974158343026, 0.15344896095332672],
    [1005.420369389582, 0.15344896095332672],
    [1016.9433229448614, 0.15344896095332672],
    [1028.4662765001406, 0.15344896095332672],
    [1039.98923005542, 0.15344896095332672],
    [1051.5121836106994, 0.15344896095332672],
    [1063.0351371659788, 0.15344896095332672],
    [1074.5580907212582, 0.15344896095332672],
    [1086.0810442765373, 0.15344896095332672],
    [1096.5564565995187, 0.15344896095332672],
]

G = [
    [304.6152849821373, 2.2526525340658026],
    [316.13823853741667, 1.348208441395002],
    [327.66119209269607, 1.2700466062259181],
    [339.1841456479754, 1.3817063707531787],
    [350.70709920325476, 1.3817063707531787],
    [362.23005275853416, 1.392872347205909],
    [372.8364077355526, 1.443119241243167],
    [384.2284186367947, 2.8829098716196455],
    [393.13251911132875, 5.895552351767606],
    [403.08416081816097, 7.701649042996024],
    [414.6071143734403, 6.696711162250693],
    [426.13006792871965, 5.434955823092665],
    [437.65302148399905, 4.977150788530906],
    [449.1759750392784, 5.524283634714479],
    [460.69892859455774, 6.082582457350767],
    [469.0792584529427, 9.226177028008195],
    [471.698111533688, 12.002842990317035],
    [473.79319399828427, 15.03992876772746],
    [475.8882764628805, 17.226226957171193],
    [479.0309001597749, 24.595771415970276],
    [481.12598262437115, 29.190363948925253],
    [483.2210650889674, 33.705347205319136],
    [484.49307944247226, 38.33470787130283],
    [486.8874594020108, 43.142458303947954],
    [488.458771250458, 48.01454602948734],
    [490.778326836261, 52.30174927416966],
    [492.47434597426746, 55.58880005658639],
    [493.6964774119486, 59.10980463134595],
    [496.31533049269393, 62.667202018247735],
    [499.4579541895883, 65.84474942841511],
    [502.18156139356347, 68.44456094582479],
    [507.8382840479733, 71.69066981458153],
    [517.2661551386564, 73.68140390215322],
    [528.7891086939358, 74.3864555581682],
    [540.3120622492152, 72.95561543272603],
    [549.7399333398982, 70.37467973265312],
    [556.548951349836, 67.70760649994489],
    [562.3104281274757, 64.90717960560123],
    [568.0719049051154, 62.200919112675564],
    [573.8333816827551, 59.35545611330593],
    [579.5948584603948, 56.46905120027628],
    [584.8325646218854, 53.45982054626666],
    [589.0227295510779, 50.819067115196994],
    [592.8986321105808, 47.981792498559344],
    [595.8317475610156, 44.96437346181772],
    [598.97437125791, 41.996084721468094],
    [602.1169949548043, 39.29391841990844],
    [604.8406021587796, 36.558998587420774],
    [607.7737176092143, 33.365529321941175],
    [610.4973248131894, 30.041045932749597],
    [613.6399485100837, 27.113699106059954],
    [616.7825722069781, 24.16588132254033],
    [619.4014252877234, 21.463715020980658],
    [623.4170000115329, 18.925316374060984],
    [629.3530669945555, 15.82601350999937],
    [636.1620850044934, 13.224154896906683],
    [646.1137267113256, 10.74996061459018],
    [657.6366802666049, 8.963404382154053],
    [669.1596338218843, 8.326943724348666],
    [680.6825873771636, 7.869138689786908],
    [692.205540932443, 6.484557609648888],
    [703.7284944877224, 4.843159071098185],
    [715.2514480430018, 2.293594447725795],
    [726.7744015982812, 0.8457395010223365],
    [738.2973551535604, 0.6112539955150851],
    [749.8203087088398, 0.5219261838932852],
    [761.3432622641192, 0.5219261838932852],
    [770.2473627386532, 0.5219261838932852],
    [794.166220876127, 0.26262739737998686],
    [803.2449115560441, 0.17099549537903158],
    # added from B
    [821.0531125051123, 0.15344896095332672],
    [832.5760660603917, 0.15344896095332672],
    [844.0990196156708, 0.15344896095332672],
    [855.6219731709502, 0.15344896095332672],
    [867.1449267262296, 0.15344896095332672],
    [878.667880281509, 0.15344896095332672],
    [890.1908338367884, 0.15344896095332672],
    [901.7137873920676, 0.15344896095332672],
    [913.236740947347, 0.15344896095332672],
    [924.7596945026264, 0.15344896095332672],
    [936.2826480579058, 0.15344896095332672],
    [947.8056016131852, 0.15344896095332672],
    [959.3285551684644, 0.15344896095332672],
    [970.8515087237438, 0.15344896095332672],
    [982.3744622790232, 0.15344896095332672],
    [993.8974158343026, 0.15344896095332672],
    [1005.420369389582, 0.15344896095332672],
    [1016.9433229448614, 0.15344896095332672],
    [1028.4662765001406, 0.15344896095332672],
    [1039.98923005542, 0.15344896095332672],
    [1051.5121836106994, 0.15344896095332672],
    [1063.0351371659788, 0.15344896095332672],
    [1074.5580907212582, 0.15344896095332672],
    [1086.0810442765373, 0.15344896095332672],
    [1096.5564565995187, 0.15344896095332672],
]

R = [
    [304.6152849821373, 0.778743642305983],
    [316.13823853741667, 0.6224199719678154],
    [327.66119209269607, 0.5219261838932852],
    [339.1841456479754, 0.3544365371023872],
    [350.70709920325476, 0.2762747019333176],
    [362.23005275853416, 0.2762747019333176],
    [373.75300631381344, 0.2874406783860479],
    [384.2284186367947, 1.6955943754798],
    [391.56120726288157, 4.403219598860801],
    [401.16366855894773, 8.30088977929232],
    [417.01645920772603, 5.692889879150641],
    [428.2251503933159, 4.240196342650989],
    [439.74810394859526, 3.235258461905673],
    [451.2710575038746, 2.5764658511948397],
    [462.794011059154, 2.051664957916728],
    [474.31696461443335, 2.1633247224439884],
    [485.8399181697127, 2.3531463221403186],
    [497.36287172499203, 2.1744906988967188],
    [508.88582528027143, 2.4648060866675934],
    [520.4087788355507, 3.7153954493728776],
    [531.9317323908301, 5.45170478777176],
    [543.4546859461095, 4.418851965894618],
    [554.9776395013889, 2.4648060866675934],
    [566.5005930566682, 2.051664957916728],
    [574.8809229150531, 4.951841241904717],
    [578.0235466119475, 7.932412556352361],
    [580.6423996926928, 11.392004260621917],
    [582.8422362805189, 15.261015101491438],
    [583.2612527734382, 18.53636819429103],
    [584.5706793138108, 21.52512789147066],
    [585.9848599774133, 25.283595565458185],
    [586.9276470864816, 30.12292976006958],
    [585.3563352380345, 27.78924068144987],
    [587.9751883187797, 33.899821295204106],
    [589.3719099618438, 37.26729369373869],
    [590.0702707833759, 40.62453061385827],
    [592.1653532479722, 44.26836092959781],
    [595.2032228216367, 50.26635128078706],
    [597.4030594094629, 53.61335272249164],
    [600.0219124902081, 56.407638329786295],
    [608.4022423485931, 58.11603272705335],
    [619.9251959038725, 56.508132117860825],
    [631.4481494591519, 54.00695339245023],
    [642.7293627300547, 51.66310041218765],
    [654.4940565697106, 49.786214293319844],
    [663.3981570442446, 47.33900445409743],
    [669.1596338218843, 44.61636719570777],
    [673.1402905046172, 41.57028881940415],
    [675.8638977085923, 38.96638311062847],
    [678.5875049125674, 35.91621054295886],
    [681.7301286094618, 32.80462510479924],
    [684.4537358134369, 29.607061647953635],
    [686.9678347709523, 26.161799613465078],
    [689.9608097203757, 22.384908078330554],
    [693.7020284071546, 18.980880399742404],
    [698.4907883262317, 16.079853374691325],
    [702.1571826392751, 13.295803245811683],
    [705.5242794573762, 10.418171599994906],
    [709.8042336350516, 7.621254012536383],
    [716.2989892752998, 4.575175636232771],
    [725.7268603659829, 2.107494840180351],
    [737.2498139212623, 1.225382700415011],
    [748.7727674765417, 0.8792374303805133],
    [755.0580148703305, 0.7675776658532527],
    # added from B
    [763.4383447287155, 0.23161079612241053],
    [774.9612982839947, 0.2762747019333176],
    [786.4842518392741, 0.2762747019333176],
    [798.0072053945535, 0.5889220426096387],
    [809.5301589498329, 0.2762747019333176],
    [821.0531125051123, 0.15344896095332672],
    [832.5760660603917, 0.15344896095332672],
    [844.0990196156708, 0.15344896095332672],
    [855.6219731709502, 0.15344896095332672],
    [867.1449267262296, 0.15344896095332672],
    [878.667880281509, 0.15344896095332672],
    [890.1908338367884, 0.15344896095332672],
    [901.7137873920676, 0.15344896095332672],
    [913.236740947347, 0.15344896095332672],
    [924.7596945026264, 0.15344896095332672],
    [936.2826480579058, 0.15344896095332672],
    [947.8056016131852, 0.15344896095332672],
    [959.3285551684644, 0.15344896095332672],
    [970.8515087237438, 0.15344896095332672],
    [982.3744622790232, 0.15344896095332672],
    [993.8974158343026, 0.15344896095332672],
    [1005.420369389582, 0.15344896095332672],
    [1016.9433229448614, 0.15344896095332672],
    [1028.4662765001406, 0.15344896095332672],
    [1039.98923005542, 0.15344896095332672],
    [1051.5121836106994, 0.15344896095332672],
    [1063.0351371659788, 0.15344896095332672],
    [1074.5580907212582, 0.15344896095332672],
    [1086.0810442765373, 0.15344896095332672],
    [1096.5564565995187, 0.15344896095332672],
]

plt.figure()
plt.plot([_[0] for _ in R], [_[1] for _ in R], ".-", color="r")
plt.plot([_[0] for _ in G], [_[1] for _ in G], ".-", color="g")
plt.plot([_[0] for _ in B], [_[1] for _ in B], ".-", color="b")
plt.grid()
plt.xlim([300, 1100])
plt.ylim([0, 80])
# plt.show()

sensitivities = {}
for i in range(300, 1100, 10):
    b, g, r = None, None, None
    for ci, C in enumerate([B, G, R]):
        if i < C[0][0]:
            c = C[0][0]
        elif i > C[-1][0]:
            c = C[-1][0]
        else:
            if i in [_[0] for _ in C]:
                c = C[:][0].index(i)
            else:
                # find tuple above / below
                _i = [_[0] for _ in C]
                _iBelow = min([_ for _ in _i if _ < i], key=lambda x: abs(x-i))
                _iAbove = min([_ for _ in _i if _ >= i], key=lambda x: abs(x-i))
                _c = [_[1] for _ in C]
                c = np.interp(
                    i,
                    [_iBelow, _iAbove],
                    [_c[_i.index(_iBelow)], _c[_i.index(_iAbove)]]
                )
        if ci == 0:
            b = c
        elif ci == 1:
            g = c
        else:
            r = c
    sensitivities.update(
        {i: (r, g, b)}
    )
print(sensitivities)

illuminant = colour.SDS_ILLUMINANTS["D65"]
M, RGB_w = colour.matrix_idt(
    sensitivities=colour.characterisation.RGB_CameraSensitivities(sensitivities),
    illuminant=illuminant
)

print(RGB_w)

print(M)

# srgb2aces = [
#     [0.613132422390542, 0.339538015799666, 0.047416696048269],
#     [0.070124380833917, 0.916394011313573, 0.013451523958235],
#     [0.020587657528185, 0.109574571610682, 0.869785404035327]
# ]

# aces2srgb = np.linalg.inv(srgb2aces)

aces2srgb = colour.matrix_RGB_to_RGB("ACES2065-1", "sRGB")

M = np.matmul(aces2srgb, M)

print(M)

CCM = np.zeros((3, 3)).tolist()

for i in range(3):
    for j in range(3):
        CCM[i][j] = [int(np.round(M[i][j] * 1e6, 0)), int(1e6)]

print(CCM)

print("[")
print(str(CCM[0][0]) + ", " + str(CCM[0][1]) + ", ", str(CCM[0][2]) + ",")
print(str(CCM[1][0]) + ", " + str(CCM[1][1]) + ", ", str(CCM[1][2]) + ",")
print(str(CCM[2][0]) + ", " + str(CCM[2][1]) + ", ", str(CCM[2][2]) + ",")
print("]")
